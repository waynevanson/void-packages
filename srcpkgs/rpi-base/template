# Template file for 'rpi-base'
pkgname=rpi-base
version=3.0
revision=1
archs="armv6l* armv7l* aarch64*"
build_style=meta
short_desc="Void Linux Raspberry Pi base files (transitional dummy package)"
maintainer="Piraty <piraty1@inbox.ru>"
license="Public Domain"
homepage="https://www.voidlinux.org"

_base_depends="virtual?ntp-daemon rpi-firmware"

# support legacy installations (before rpi4 was added)
# make the meta package depend on the flavor package
# !! don't drop before 2022-02 !!
case "$XBPS_TARGET_MACHINE" in
	armv6*) depends="rpi1-base" ;;
	armv7*) depends="rpi2-base" ;;
	aarch64*) depends="rpi3-base" ;;
esac

# handle all raspberry pi flavors
case "$XBPS_TARGET_MACHINE" in
	armv6*)
		subpackages="rpi1-base"
		;;
	armv7*)
		subpackages="rpi2-base"
		;;
	aarch64*)
		subpackages="rpi3-base rpi4-base"
		;;
esac


rpi1-base_package() {
	depends="${_base_depends} rpi1-kernel"
	short_desc="Void Linux Raspberry Pi zero / 1 base files"
	pkg_install() {
		vinstall "${FILESDIR}/71-raspberrypi.rules" 644 usr/lib/udev/rules.d
	}
}

rpi2-base_package() {
	depends="${_base_depends} rpi2-kernel"
	short_desc="Void Linux Raspberry Pi 2 base files"
	pkg_install() {
		vinstall "${FILESDIR}/71-raspberrypi.rules" 644 usr/lib/udev/rules.d
	}
}


rpi3-base_package() {
	depends="${_base_depends} rpi3-kernel"
	short_desc="Void Linux Raspberry Pi 3 base files"
	pkg_install() {
		vinstall "${FILESDIR}/71-raspberrypi.rules" 644 usr/lib/udev/rules.d
	}
}

rpi4-base_package() {
	depends="${_base_depends} rpi4-kernel"
	short_desc="Void Linux Raspberry Pi 4 base files"
	conflicts="rpi3-base"
	pkg_install() {
		vinstall "${FILESDIR}/71-raspberrypi.rules" 644 usr/lib/udev/rules.d
	}
}
